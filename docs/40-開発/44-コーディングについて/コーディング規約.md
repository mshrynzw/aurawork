# コーディング規約

## 概要

本ドキュメントには、auraworkシステムの開発におけるコーディング規約を記載します。

---

## 1. 一般規則

### 1.1 基本方針
- **可読性を重視**: 他人が読んで理解しやすいコードを書く
- **一貫性を保持**: プロジェクト全体で統一されたスタイルを守る
- **DRY原則**: 同じコードの重複を避ける（Don't Repeat Yourself）

### 1.2 ファイル名
- **PascalCase**: クラス名（例: `AttendanceRegisterController.php`）
- **snake_case**: ファイル名、関数名（例: `attendance_register.ts`）
- **kebab-case**: URL、ルート名（例: `attendance-register`）

---

## 2. PHP/Laravel 規約

### 2.1 PSR 規約
LaravelはPSR-12に準拠しています。

- **PSR-1**: Basic Coding Standard
- **PSR-12**: Extended Coding Style Guide

### 2.2 インデント
- **インデント**: 4スペース（タブ禁止）
- **行末空白**: 削除する

### 2.3 命名規則

#### クラス名
```php
// コントローラー
class AttendanceRegisterController extends Controller
{
}

// モデル
class AttendanceManage extends Model
{
}

// サービス
class SalaryCalculationService
{
}
```

#### メソッド名
```php
// camelCaseを使用
public function getAttendanceData()
{
}

public function calculateSalary()
{
}
```

#### 変数名
```php
// camelCaseを使用
$accountInfoId;
$payrollYear;
$attendanceRecord;

// 配列の複数形
$employees = [];
$attendances = [];
```

#### 定数
```php
// UPPER_SNAKE_CASEを使用
class PremiumRateSetting extends Model
{
    const OVERTIME_RATE = 1.25;
    const NIGHT_SHIFT_RATE = 1.35;
}
```

### 2.4 コードスタイル例

#### コントローラー
```php
<?php

namespace App\Http\Controllers;

use App\Models\AccountInfos;
use Illuminate\Http\Request;

class AttendanceRegisterController extends Controller
{
    public function showAttendanceRegisterPage() 
    {
        $employees = AccountInfos::select('id', 'real_name')->get();

        return view('attendance.register.attendance_register', [
            'employees' => $employees,
        ]);
    }
}
```

#### モデル
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AttendanceManage extends Model
{
    protected $table = 'attendance_manages';

    protected $fillable = [
        'account_info_id',
        'workday_ymd',
        'beginning_time',
        'finishing_time',
    ];

    public function accountInfo()
    {
        return $this->belongsTo(AccountInfos::class);
    }
}
```

### 2.5 コメント
```php
/**
 * コントローラークラスの説明
 *
 * @package App\Http\Controllers
 */
class ExampleController extends Controller
{
    /**
     * メソッドの説明
     *
     * @param Request $request リクエストオブジェクト
     * @return \Illuminate\Http\Response
     */
    public function exampleMethod(Request $request)
    {
        // 一行コメント
        $data = $request->all();

        // 複数行コメント（必要に応じて）
        /*
         * 複数行の説明
         * ここに詳細を記述
         */
    }
}
```

---

## 3. JavaScript 規約

### 3.1 命名規則
- **変数・関数**: camelCase
- **定数**: UPPER_SNAKE_CASE
- **クラス**: PascalCase

```javascript
// 変数
const employeeId = 1;
const attendanceData = {};

// 関数
function fetchAttendanceData(id) {
    // 処理
}

// 定数
const API_BASE_URL = '/api';
const MAX_RETRY_COUNT = 3;

// クラス
class AttendanceManager {
    constructor() {
        // 初期化
    }
}
```

### 3.2 コードスタイル

#### インデント
- **2スペース**を使用

```javascript
function example() {
  if (condition) {
    // 処理
  } else {
    // 処理
  }
}
```

#### アロー関数
```javascript
// シンプルな処理
const users = employees.map(emp => emp.id);

// 複数行
const result = data.map(item => {
    return item.value * 2;
});
```

#### 非同期処理
```javascript
// Promise
fetch('/api/attendance')
    .then(response => response.json())
    .then(data => {
        console.log(data);
    })
    .catch(error => {
        console.error(error);
    });

// async/await（推奨）
async function fetchData() {
    try {
        const response = await fetch('/api/attendance');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error(error);
    }
}
```

---

## 4. Blade テンプレート規約

### 4.1 インデント
- **4スペース**を使用

### 4.2 ディレクトリ構造
```
resources/views/
├── attendance/
│   └── register/
│       └── attendance_register.blade.php
├── company-allowance/
│   ├── add.blade.php
│   └── assign.blade.php
```

### 4.3 コメント
```blade
{{-- HTMLコメントではないが表示されない --}}
<!-- HTMLコメント（ブラウザのソースに残る） -->
@{{-- Bladeコメント --}}
```

### 4.4 データ表示
```blade
{{-- エスケープ処理あり（推奨） --}}
{{ $employeeName }}

{{-- エスケープ処理なし（必要な場合のみ） --}}
{!! $htmlContent !!}

{{-- 条件分岐 --}}
@if($isActive)
    <span>有効</span>
@else
    <span>無効</span>
@endif

{{-- ループ --}}
@foreach($employees as $employee)
    <div>{{ $employee->name }}</div>
@endforeach
```

---

## 5. CSS 規約

### 5.1 命名規則
- **BEM方式**: ブロック__エレメント--修飾子
- **キャメルケース**: クラス名（例: `.container-box`）

```css
/* ブロック */
.container-box {
    width: 550px;
}

/* エレメント */
.form-group {
    margin-bottom: 10px;
}

/* 修飾子 */
.button--primary {
    background-color: #007bff;
}
```

### 5.2 インデント
- **2スペース**を使用

---

## 6. データベース規約

### 6.1 テーブル名
- **snake_case**: すべて小文字、単数形または複数形を統一

```sql
-- 良い例
account_infos
attendance_manages
payroll_calculation_dates

-- 悪い例
account_info
attendanceManage
PayrollCalculationDate
```

### 6.2 カラム名
- **snake_case**: すべて小文字、意味のある名前

```sql
-- 良い例
account_info_id
real_name
payroll_year
workday_ymd

-- 悪い例
id
name
year
ymd
```

### 6.3 外部キー
```sql
-- パターン: {参照元テーブル名}_id
account_info_id
company_allowance_info_id
```

---

## 7. Git/コミット規約

### 7.1 コミットメッセージ
```
<タイプ>: <短い説明>

<詳細（必要な場合）>

<例>
feat: 勤怠登録機能を追加

- 従業員選択機能
- 勤怠データ取得機能
- データ保存機能
```

#### コミットタイプ
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `style`: コードスタイル
- `refactor`: リファクタリング
- `test`: テスト
- `chore`: その他

### 7.2 ブランチ命名
```
<タイプ>/<機能名>

<例>
feature/attendance-register
bugfix/salary-calculation
hotfix/payment-error
```

---

## 8. セキュリティ規約

### 8.1 入力値検証
```php
// バリデーション必須
$request->validate([
    'account_info_id' => 'required|integer|exists:account_infos,id',
    'base_salary' => 'required|numeric|min:0|max:1000000',
]);
```

### 8.2 SQLインジェクション対策
```php
// Eloquentを使用（推奨）
$employee = AccountInfos::find($id);

// クエリビルダーを使用
DB::table('account_infos')->where('id', $id)->first();

// プレースホルダーを使用
DB::select('SELECT * FROM account_infos WHERE id = ?', [$id]);
```

### 8.3 XSS対策
```blade
{{-- エスケープ処理（推奨） --}}
{{ $userInput }}

{{-- HTML出力が必要な場合のみ --}}
{!! $trustedHtml !!}
```

---

## 9. パフォーマンス規約

### 9.1 N+1問題の回避
```php
// 悪い例
$employees = AccountInfos::all();
foreach ($employees as $employee) {
    echo $employee->payrollCalculationDates->count();
}

// 良い例
$employees = AccountInfos::with('payrollCalculationDates')->get();
foreach ($employees as $employee) {
    echo $employee->payrollCalculationDates->count();
}
```

### 9.2 キャッシュの活用
```php
// データのキャッシュ
$data = Cache::remember('key', 3600, function () {
    return DB::table('account_infos')->get();
});
```

---

## 10. 参考資料

- [Laravel Style Guide](https://laravel.com/docs/10.x/contributions#coding-style)
- [PSR-12 Coding Standard](https://www.php-fig.org/psr/psr-12/)
- [PHP-FIG Standards](https://www.php-fig.org/standards/)

---

## 更新履歴

| 日付 | 更新者 | 変更内容 |
|------|--------|----------|
| 2024-12-25 | システム | 初版作成 |

