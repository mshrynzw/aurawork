# 開発環境構築

## 概要

本ドキュメントには、auraworkシステムの開発環境構築手順を記載します。

---

## 1. 必要な環境

### 1.1 システム要件

| 項目 | バージョン | 備考 |
|------|-----------|------|
| OS | Windows 10/11 | |
| PHP | 8.2以上 | XAMPPに含まれる |
| Composer | 2.x以上 |  |
| MySQL | 8.0以上 | XAMPPに含まれる |
| Node.js | 22.x | nvm windowsで管理 |
| Git | 2.x以上 | |

### 1.2 使用ツール

| ツール | 用途 | 備考 |
|--------|------|------|
| Cursor / VSCode | IDE（統合開発環境） | コードエディタ |
| XAMPP | MySQL・Apache | データベースとWebサーバー |
| Git | バージョン管理 | |
| GitHub | リモートリポジトリ | |
| SourceTree | Git GUIツール | |
| A5SQL | データベース管理ツール | |
| nvm windows | Node.jsバージョン管理 | |

---

## 2. 各ツールのインストール手順

### 2.1 Cursor / VSCode

#### Cursor
1. [Cursor公式サイト](https://cursor.sh/)にアクセス
2. Windows版をダウンロード
3. インストーラーを実行
4. 初期設定を行う

#### VSCode（代替）
1. [VSCode公式サイト](https://code.visualstudio.com/)にアクセス
2. Windows版をダウンロード
3. インストーラーを実行
4. 推奨拡張機能をインストール：
   - PHP Intelephense
   - Laravel Extension Pack
   - GitLens
   - Prettier

---

### 2.2 XAMPP

#### インストール手順

1. **ダウンロード**
   - [XAMPP公式サイト](https://www.apachefriends.org/)にアクセス
   - Windows版をダウンロード（最新版を推奨）

2. **インストール**
   - ダウンロードしたインストーラーを実行
   - インストール先：`C:\xampp`（デフォルト）
   - 必要なコンポーネントを選択：
     - Apache（必須）
     - MySQL（必須）
     - phpMyAdmin（推奨）

3. **起動確認**
   - XAMPP Control Panelを起動
   - ApacheとMySQLを起動
   - ブラウザで `http://localhost` にアクセスして動作確認

4. **PHPのバージョン確認**
   ```powershell
   # PowerShellで実行
   C:\xampp\php\php.exe -v
   ```
   - PHP 8.2以上であることを確認

#### MySQLの設定

1. **rootユーザーのパスワード設定（初回のみ）**
   - phpMyAdminにアクセス：`http://localhost/phpmyadmin`
   - ユーザーアカウントでrootのパスワードを設定（空のままでも可）

2. **データベース作成（後述の手順で自動作成されるが、手動で作成する場合）**
   ```sql
   CREATE DATABASE aurawork CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

---

### 2.3 Composer

#### インストール手順

1. **ダウンロード**
   - [Composer公式サイト](https://getcomposer.org/download/)にアクセス
   - Windowsインストーラーをダウンロード

2. **インストール**
   - `Composer-Setup.exe`を実行
   - PHPのパスを指定：`C:\xampp\php\php.exe`
   - インストール先：デフォルト（`C:\ProgramData\ComposerSetup\bin`など）

3. **パスの確認**
   ```powershell
   composer --version
   ```
   - バージョンが表示されればOK（Composer 2.x以上を推奨）

4. **グローバル設定（オプション）**
   ```powershell
   composer config -g github-oauth.github.com <your-token>
   ```

---

### 2.4 Git

#### インストール手順

1. **ダウンロード**
   - [Git公式サイト](https://git-scm.com/download/win)にアクセス
   - Windows版をダウンロード

2. **インストール**
   - インストーラーを実行
   - 推奨設定：
     - Editor: CursorまたはVSCodeを選択
     - Default branch name: `main`
     - Git from the command line and also from 3rd-party software: 選択

3. **設定**
   ```powershell
   # ユーザー名とメールアドレスを設定
   git config --global user.name "Your Name"
   git config --global user.email "your.email@example.com"
   
   # 改行コードの設定（Windows用）
   git config --global core.autocrlf true
   ```

4. **確認**
   ```powershell
   git --version
   ```

---

### 2.5 GitHub

#### アカウント設定

1. **GitHubアカウント作成**
   - [GitHub公式サイト](https://github.com/)にアクセス
   - アカウントを作成（既にある場合はスキップ）

2. **SSH鍵の設定（推奨）**
   ```powershell
   # SSH鍵を生成
   ssh-keygen -t ed25519 -C "your.email@example.com"
   
   # 公開鍵をコピー
   cat ~/.ssh/id_ed25519.pub
   ```
   - GitHubのSettings > SSH and GPG keysに公開鍵を登録

3. **リポジトリのクローン**
   ```powershell
   # SSHを使用する場合
   git clone git@github.com:username/repository.git
   
   # HTTPSを使用する場合
   git clone https://github.com/username/repository.git
   ```

---

### 2.6 SourceTree

#### インストール手順

1. **ダウンロード**
   - [SourceTree公式サイト](https://www.sourcetreeapp.com/)にアクセス
   - Windows版をダウンロード

2. **インストール**
   - インストーラーを実行
   - 初期設定でGitのパスを指定（通常は自動検出される）

3. **リポジトリの追加**
   - 「新規/クローンを作成」をクリック
   - リモートURLを入力してクローン

---

### 2.7 A5SQL

#### インストール手順

1. **ダウンロード**
   - [A5SQL公式サイト](http://www.a5m2.com/)にアクセス
   - Windows版をダウンロード

2. **インストール**
   - ダウンロードしたZIPファイルを解凍
   - `A5SQL.exe`を実行（インストール不要）

3. **データベース接続設定**
   - 新規接続を追加
   - 接続情報：
     - ホスト: `localhost` または `127.0.0.1`
     - ポート: `3306`
     - ユーザー名: `root`
     - パスワード: （設定したパスワード、または空）
     - データベース: （初回は空欄で可。SQLファイル実行後は`kintai`を指定）
   - **注意**: 初回接続時はデータベース名を空欄にしても接続できます。SQLファイル（`00-create_database_kintai.sql`）実行後に`kintai`データベースが作成されるので、その後は`kintai`を指定してください。

---

### 2.8 nvm windows

#### インストール手順

1. **ダウンロード**
   - [nvm-windows公式サイト](https://github.com/coreybutler/nvm-windows/releases)にアクセス
   - 最新の`nvm-setup.exe`をダウンロード

2. **インストール**
   - インストーラーを実行
   - インストール先：デフォルト（`C:\Users\<ユーザー名>\AppData\Roaming\nvm`）

3. **Node.js 22.xのインストール**
   ```powershell
   # PowerShellを管理者権限で起動して実行
   nvm install 22
   nvm use 22
   
   # バージョン確認
   node --version
   npm --version
   ```

4. **pnpmのインストール**
   ```powershell
   # pnpmをグローバルにインストール
   npm install -g pnpm
   
   # バージョン確認
   pnpm --version
   ```

---

## 3. プロジェクトのセットアップ

### 3.1 リポジトリのクローン

```powershell
# プロジェクトディレクトリに移動
cd C:\Users\<ユーザー名>\Documents

# リポジトリをクローン
git clone <repository-url> aurawork

# プロジェクトディレクトリに移動
cd aurawork
```

### 3.2 PHP依存関係のインストール

```powershell
# ComposerでPHP依存関係をインストール
composer install
```

### 3.3 JavaScript依存関係のインストール

```powershell
# Node.js 22.xを使用（nvmで切り替え）
nvm use 22

# pnpmでJavaScript依存関係をインストール
pnpm install
```

### 3.4 環境変数の設定

```powershell
# .envファイルをコピー
copy .env.example .env

# .envファイルを編集（エディタで開く）
# CursorやVSCodeで開いて編集
```

`.env`ファイルの編集内容：

```env
APP_NAME=aurawork
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost:8000

# データベース設定
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=kintai
DB_USERNAME=root
DB_PASSWORD=

# その他の設定はデフォルトのまま
```

```powershell
# APP_KEYを生成
php artisan key:generate
```

### 3.5 データベースのセットアップ

#### A5SQLを使用したデータベースの作成

1. **A5SQLを起動**
   - A5SQLを起動
   - 2.7で設定したデータベース接続に接続

2. **SQLファイルの実行**
   - A5SQLで「SQL実行」を開く
   - 以下のSQLファイルを順番に実行：
     1. `database\sql\00-create_database_kintai.sql`
        - データベース`kintai`を作成し、すべてのテーブルを作成
     2. `database\sql\01-attendance_manages_test_data.sql`
        - テストデータを挿入（オプション）

3. **SQLファイルの実行方法**
   - ファイルメニューから「SQLファイルを開く」を選択
   - または、SQLエディタにファイルの内容をコピー＆ペースト
   - 「実行」ボタンをクリックしてSQLを実行

4. **実行確認**
   - エラーが表示されないことを確認
   - データベース一覧に`kintai`データベースが表示されることを確認
   - テーブル一覧に必要なテーブルが作成されていることを確認

**注意**: `.env`ファイルの`DB_DATABASE`は`kintai`に設定してください（3.4で設定済み）。

### 3.6 ストレージの設定

```powershell
# ストレージリンクの作成（シンボリックリンク）
php artisan storage:link

# ディレクトリの権限確認（Windowsでは通常問題なし）
```

### 3.7 アセットのビルド

```powershell
# 開発環境用にビルド（Hot Reload有効）
pnpm run dev

# 別のターミナルで実行（このコマンドは継続実行される）
```

---

## 4. 開発サーバーの起動

### 4.1 Laravel開発サーバー

```powershell
# 開発サーバーを起動
php artisan serve

# ブラウザでアクセス
# http://localhost:8000
```

### 4.2 開発時の推奨手順

1. **XAMPPの起動**
   - XAMPP Control Panelを起動
   - ApacheとMySQLを起動

2. **Vite開発サーバーの起動**
   ```powershell
   pnpm run dev
   ```
   - 別のターミナルウィンドウで実行
   - Hot Reloadが有効になる

3. **Laravel開発サーバーの起動**
   ```powershell
   php artisan serve
   ```
   - さらに別のターミナルウィンドウで実行

4. **ブラウザでアクセス**
   - `http://localhost:8000` にアクセス

---

## 5. 動作確認

### 5.1 基本動作確認

1. **トップページにアクセス**
   - `http://localhost:8000` が表示されることを確認

2. **データベース接続確認**
   ```powershell
   php artisan tinker
   # tinker内で実行
   DB::connection()->getPdo();
   # エラーがなければOK
   exit
   ```

3. **ログファイルの確認**
   - `storage/logs/laravel.log` が作成されていることを確認

### 5.2 よくある問題と解決方法

#### 問題: データベース接続エラー

**症状**: `SQLSTATE[HY000] [1045] Access denied`

**解決方法**:
1. XAMPPのMySQLが起動しているか確認
2. `.env`ファイルのデータベース設定を確認
3. MySQLのrootパスワードを確認

#### 問題: ページが表示されない

**症状**: 500エラーやページが真っ白

**解決方法**:
```powershell
# キャッシュをクリア
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear

# ログを確認
# storage/logs/laravel.log を確認
```

#### 問題: Composerのインストールエラー

**症状**: `composer install`でエラーが発生

**解決方法**:
1. PHPのバージョンを確認（8.2以上が必要）
2. `composer.json`の`require`を確認
3. メモリ制限を増やす：
   ```powershell
   # php.iniを編集
   # memory_limit = 512M に設定
   ```

#### 問題: pnpmコマンドが見つからない

**症状**: `pnpm: command not found`

**解決方法**:
```powershell
# pnpmを再インストール
npm install -g pnpm

# パスを確認
# 環境変数PATHにNode.jsのパスが含まれているか確認
```

---

## 6. 開発環境の確認チェックリスト

セットアップ完了後、以下の項目を確認してください：

- [ ] XAMPPのApacheとMySQLが起動できる
- [ ] PHPのバージョンが8.2以上である
- [ ] Composerがインストールされ、動作する
- [ ] Gitがインストールされ、動作する
- [ ] Node.js 22.xがインストールされ、動作する
- [ ] pnpmがインストールされ、動作する
- [ ] GitHubアカウントが設定されている
- [ ] リポジトリをクローンできる
- [ ] `composer install`が成功する
- [ ] `pnpm install`が成功する
- [ ] `.env`ファイルが作成され、設定されている
- [ ] A5SQLでデータベースに接続できる
- [ ] SQLファイル（`00-create_database_kintai.sql`）を実行してデータベースが作成できる
- [ ] `php artisan serve`でサーバーが起動する
- [ ] `pnpm run dev`でViteが起動する
- [ ] ブラウザで `http://localhost:8000` にアクセスできる

---

## 7. 補足情報

### 7.1 パスの確認方法

各ツールが正しくインストールされているか確認：

```powershell
# PHP
C:\xampp\php\php.exe -v

# Composer
composer --version

# Git
git --version

# Node.js
node --version

# npm
npm --version

# pnpm
pnpm --version
```

### 7.2 環境変数PATHの設定

ツールが見つからない場合は、環境変数PATHを確認・設定：

1. 「システムのプロパティ」→「詳細設定」→「環境変数」
2. システム環境変数の`Path`を編集
3. 必要なパスを追加：
   - `C:\xampp\php`
   - `C:\ProgramData\ComposerSetup\bin`
   - `C:\Program Files\Git\cmd`
   - Node.jsのパス（nvmで自動設定される）

### 7.3 開発ツールの推奨設定

#### Cursor / VSCodeの推奨拡張機能

- **PHP関連**
  - PHP Intelephense
  - Laravel Extension Pack

- **Git関連**
  - GitLens

- **その他**
  - Prettier
  - ESLint
  - Auto Rename Tag

#### ターミナル設定

- PowerShellまたはGit Bashを使用
- 複数のターミナルウィンドウを開いて各コマンドを実行

---

## 8. 参考資料

- [README.md](../../README.md)
- [開発ガイドライン.md](開発ガイドライン.md)
- [コーディング規約.md](コーディング規約.md)
- [Laravel公式ドキュメント](https://laravel.com/docs/10.x)
- [Composer公式ドキュメント](https://getcomposer.org/doc/)

---

## 更新履歴

| 日付 | 更新者 | 変更内容 |
|------|--------|----------|
| 2025-11-03 | 米沢 | 初版作成 |
